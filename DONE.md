# DONE

- [2026-02-12] Pattern-bound variable type inference in match: `assign_pattern_types` in typecheck.rs propagates scrutinee type through patterns to assign type_ids to bindings; handles built-in Option/Result generics, user-defined enums (with generic substitution via `variant_field_types` on `EnumVariantInfo`), tuples, and or-patterns; `print("{e}")` in `case Error(e):` for `Result[int, str]` now correctly prints strings instead of garbage `%lld` output; updated `match_option_result.gg` to test `Result[int, str]`
- [2026-02-12] Multi-file todo_app showcase (`examples/todo_app/`): Task struct with Displayable trait, Priority enum, TaskStore wrapping `Vector[Task]` with filter/count methods; demonstrates Vector of user-defined structs, closures with struct types in filter, `&self` mutation, cross-module trait equip, format() with field access; required fixing `infer_vector_elem_type` to extract element type from AST field annotations when `resolve_expr_type_id` can't resolve generic field types like `Vector[Task]`
- [2026-02-12] Multi-file calculator showcase (`examples/calculator/`): recursive `Expr` enum with `Box[Expr]` payloads (Num, Add, Mul, Neg), recursive `eval()` using match destructuring + Box dereference, helper functions with expression-body syntax, cross-module imports; required fixing two codegen bugs: (1) `box_inner_c_type` now uses `resolve_expr_type_id` for reliable type resolution instead of falling back to `int64_t`, (2) `Expr::Deref` handler always emits C dereference `(*inner)` since Gorget `*` is exclusively Box dereference
- [2026-02-12] Multi-file shapes showcase (`examples/shapes/`): Shape trait in `shape.gg`, Circle and Rect structs in separate modules with cross-module `equip ... with Shape`, inherent methods (circumference, is_square), Box[Shape] dynamic dispatch in `main.gg`; demonstrates traits, modules/imports, struct methods, vtable dispatch, string interpolation
- [2026-02-12] Match on generic enum variants (`case Some(x):` for `Option[int]`, `case Ok(v):`/`case Error(e):` for `Result[int,int]`, `is Some`/`is None`): fixed tag constant names in `pattern_to_condition` (c_stmt.rs) and `pattern_to_condition_expr` (c_expr.rs) to use monomorphized enum names (e.g. `Option__int64_t_TAG_Some`) instead of raw names (`Option_TAG_Some`); added `resolve_enum_c_type_for_scrutinee()` helper to resolve scrutinee type to mangled C name via `ResolvedType::Generic`; also fixed `Pattern::Literal(NoneLiteral)` to generate tag checks instead of `== NULL` when matching on Option enums; integration test `match_option_result.gg`
- [2026-02-12] Nested generics (`Vector[Vector[int]]`, `Option[Vector[int]]`, `Dict[str, Vector[int]]`): structural unification in `unify()` for Generic/Tuple/Array/Slice/Function types (was failing because fresh TypeIds for structurally identical compound types didn't match); recursive generic arg scanning in `scan_type_for_generics()` to register nested instantiations; improved `display()` and `describe_resolved_type()` to show generic args in error messages; integration test `nested_generics.gg`
- [2026-02-12] Implement automatic `Box[Trait]` dispatch: semantic resolves `Box[Trait]` to `ResolvedType::TraitObject` (added `DefKind::Trait` to allowed types in `ast_type_to_resolved`), codegen detects `Box[Trait]` patterns in `extract_trait_object_construction` for trait object construction (`{.data=..., .vtable=&vtable}`), vtable dispatch via `recv.vtable->method(recv.data)` in `gen_method_call`, `TraitObjFree` drop action (`free(.data)`), `ast_type_to_c` maps `Box[Trait]` to `Trait_TraitObj`; updated `dynamic_dispatch.gg` fixture to exercise both direct and vtable dispatch
- [2026-02-12] Remove `dynamic` keyword from compiler source: lexer (Keyword::Dynamic variant, from_str, Display), parser (Type::Dynamic AST variant, parse_type prefix, is_type_start), semantic (ast_type_to_resolved Dynamic arm), codegen (ast_type_to_c Dynamic arms, Box[dynamic Trait] special cases, extract_trait_object_construction, 3 unit tests), formatter (Type::Dynamic arm). Internal dispatch machinery (ResolvedType::TraitObject, vtable codegen, equip-based dispatch) preserved.
- [2026-02-11] Fix struct `str` field interpolation printing pointer address: extended `resolve_field_type` to handle struct fields via `field_type_names` map, added `ast_type_to_type_id` helper to convert AST types to semantic TypeIds, added `FieldAccess` arm to `resolve_expr_type_id`; `{msg.sender}` now correctly prints string content; removed local variable workarounds in ownership example and fixture
- [2026-02-11] Borrow checker showcase: `examples/ownership.gg` (narrative example with message pipeline — borrow, mutable borrow via method, move, reassignment revival, copy types), `tests/fixtures/ownership_showcase.gg` (integration test), README "Ownership & Borrowing" section in Language Tour; also discovered and recorded bug: struct `str` field interpolation prints pointer address instead of string content
- [2026-02-11] Curl-installable `gg` binary: GitHub Actions release workflow (cross-platform matrix: macOS ARM64/x86_64, Linux x86_64/ARM64 with musl), CI workflow (build + unit + integration tests on push/PR), `install.sh` POSIX script (platform detection, latest/pinned version, PATH setup), README Install section
- [2026-02-11] String concatenation (`+` and `+=` on strings): `gorget_str_concat()` C runtime helper, codegen special-cases `str + str` to call helper instead of arithmetic, `+=` on strings emits `s = gorget_str_concat(s, rhs)`, works with string interpolation (`"{a + b}"`), chaining (`"a" + "b" + "c"`), and literals
- [2026-02-11] `gg` script execution and interactive REPL: `gg script.gg` shorthand runs a .gg file directly (equivalent to `gg run`); `gg` with no args launches interactive REPL with `>>>` prompt, multi-line block support (`:` continuation), accumulated state (definitions placed before main, statements inside), marker-based incremental output, error recovery (failed code not added to buffer), `/reset`/`/show`/`/quit`/`/help` commands, Ctrl+D exit, temp dir cleanup; refactored `build()` into `try_build()` returning `Result<PathBuf, String>` for recoverable errors
- [2026-02-11] Codegen type inference consistency pass: extracted canonical `resolve_expr_type_id()` helper handling Identifier/literals/BinaryOp/UnaryOp/Call/MethodCall/Deref; refactored 10 functions in c_expr.rs and c_stmt.rs to use it; deleted 2 duplicate functions (`infer_array_elem_type`, `infer_map_kv_types_for_iter`); fixed `builtin_method_return_type` GorgetMap/GorgetSet prefix matching; simplified `infer_interp_expr_type` to delegate to helper; added MethodCall arm and fixed BinaryOp comparison operators in `infer_c_type_from_expr`
- [2026-02-11] Fix string interpolation of method calls: `infer_interp_expr_type()` now falls back to trait/inherent method lookup when builtin methods don't match, so `"{d.speak()}"` correctly emits `%s` instead of `%lld`
- [2026-02-11] Cross-module name resolution: deferred return type fixup pass in resolve.rs (re-resolves function return types after all imports are collected), function signature pre-registration in typecheck.rs (sets DefInfo.type_id to ResolvedType::Function before body checking so callers infer correct types), 5 new cross-module test fixtures (struct, enum, struct_return, trait, auto inference)
- [2026-02-11] Arena-backed linked list example (`examples/linked_list.gg` + `tests/fixtures/linked_list.gg`): parallel-vector arena with push_front, peek, length, reset, Iterator[int] impl, for-loop iteration, fold, map — exercises struct field indexing, &self mutation, Iterator trait, and iterator adapters
- [2026-02-11] Fix parser bug: `self.values[i]` (index after field access) — Dot handler now uses save/restore backtracking for `[` ambiguity (generic method vs indexing), matching the LBracket handler pattern; updated `struct_field_methods.gg` to use direct indexing instead of `.get(i)` workaround
- [2026-02-11] Fix struct field codegen bugs: `infer_receiver_type` now handles `FieldAccess` via `field_type_names` map (resolves `self.values.push(x)` → `Vector__push` instead of `Unknown__push`); `needs_temp` uses `is_lvalue()` helper to recognize field access chains as lvalues (fixes silent data loss from temporary copies); `infer_receiver_c_type` and `infer_c_type_from_expr` also handle `FieldAccess`; new `struct_field_methods.gg` integration test
- [2026-02-11] Iterator adapters: `.map()`, `.filter()`, `.collect()`, `.fold()` on any type implementing Iterator[T] — eager evaluation draining into Vector[T] (or scalar for fold), with typecheck inference and while/next/break codegen pattern
- [2026-02-11] `?` operator for Result[T,E] propagation: dual-mode `?` — on Result values, generates value-based early return (unwrap Ok or `return Error(e)`); falls back to existing setjmp/longjmp for throws-based error handling; typecheck records expr_types map for codegen, validates enclosing function returns Result, new TryOnResultInNonResultFunction error
- [2026-02-11] Vec capacity and slicing: `Vector[T](n)` with_capacity constructor, `.reserve(n)` method, `vec[i]` element indexing via `GORGET_ARRAY_AT`, `vec[start..end]` slicing via `gorget_array_slice()` — C runtime helpers, typecheck, codegen, integration test
- [2026-02-11] `directive immutable-by-default` + `mutable` keyword: three-tier immutability (const < plain < mutable), `mutable type name = expr` prefix syntax, const assignment enforcement (always), immutable variable enforcement (under directive), `is_mutable` tracked in AST/DefInfo/scope, borrow checker enforcement with AssignmentToImmutable/AssignmentToConst errors, formatter round-trip, integration tests, language reference docs
- [2026-02-11] `directive` system: per-file compilation options via `directive strip-asserts` and `directive overflow=wrap` — full pipeline: lexer keyword, parser (hyphenated names, key=value), AST node, semantic validation (UnknownDirective error), main.rs extraction with CLI flag OR-merge, formatter, integration tests, language reference docs
- [2026-02-11] Type-safe generic HashMap[K,V]: monomorphized Dict[K,V] into per-specialization C structs (e.g. `GorgetMap__const_char_ptr__int64_t`) with typed fields and inline functions; string keys use `__gorget_hash_str()` + `strcmp()` for correct content-based hashing; all methods (put/get/contains/remove/clear/filter/fold), constructors, for-loop iteration, dict comprehensions, and `in` operator updated to use monomorphized codegen
- [2026-02-11] `format(...)` built-in function: builds interpolated strings without printing, returns `const char*` (str) via `gorget_format()` C runtime helper, supports string interpolation and non-string value formatting
- [2026-02-11] String slicing, indexing, and iteration: `str[i]` returns char with bounds checking, `str[start..end]` returns substring via `gorget_string_slice()`, `for ch in string` iterates chars via strlen-based loop; typecheck infers char/str types, for-loop variable gets char TypeId for correct interpolation
- [2026-02-11] Wrapping operators `+%`/`-%`/`*%` and `+%=`/`-%=`/`*%=`: per-expression opt-out from overflow checking (Zig-style), full pipeline: 6 new lexer tokens, 3 BinaryOp variants, parser at same precedence as regular ops, typecheck, codegen emits plain C arithmetic (skips checked macros), formatter, integration test
- [2026-02-11] Integer overflow checking: `+`/`-`/`*` and `+=`/`-=`/`*=` now panic on signed integer overflow by default, using `_Generic` + `__builtin_*_overflow` intrinsics (float-safe via C11 `_Generic` dispatch); `--overflow=wrap` flag opts out with `-fwrapv` wrapping semantics
- [2026-02-11] Raw strings (`r"..."`) and multi-line strings (`"""..."""`): verified codegen handles both correctly (lexer already stores proper characters), added integration test coverage for raw strings (backslash preservation, no interpolation) and multi-line strings (embedded newlines)
- [2026-02-11] String stdlib methods: `contains`, `starts_with`, `ends_with`, `is_empty`, `trim`, `to_upper`, `to_lower`, `replace`, `split` — C runtime helpers, typecheck registration in `builtin_method_type()`, codegen in `gen_string_method()`, integration tests
- [2026-02-10] `assert` keyword: new statement `assert condition [, message]`, desugars to `if (!cond) gorget_panic(msg)`, always-on by default with `--strip-asserts` compiler flag; full pipeline: lexer keyword, parser, AST variant, name resolution, type checking, borrow checking, codegen, formatter, integration tests
- [2026-02-10] `in` operator codegen: `x in coll` desugars to `.contains()` calls for Vector (gorget_array_contains), Dict (gorget_map_contains), Set (gorget_set_contains), str (strstr); also added .contains() as a direct method on Vector and str
- [2026-02-10] Language design: added 3 readability/sugar features — string repetition (`"x" * 3`, via Mul[int] trait), `in` keyword for containment checks (desugars to Contains trait), multiple return values via tuple destructuring at call sites
- [2026-02-10] Language design: formalized 5 safety features in docs/language-design.md — integer overflow (panic by default, wrapping operators +%/-%/*%), bounds checking (language guarantee on arrays/slices/vectors), assert (always-on, never stripped), variable initialization (zero-init like Go, --require-init flag), Sendable/Syncable thread safety traits (auto-derived, unsafe equip for manual impl)
- [2026-02-10] Chained method calls on trait/inherent methods: `infer_receiver_type()` now handles `Expr::MethodCall` by recursively resolving receiver type and looking up method return type in TraitRegistry
- [2026-02-10] Named args / default params: parser already supported syntax; added FunctionInfo.param_defaults, semantic validation (named arg matching, ordering, duplicate/unknown/missing checks, PositionalAfterNamed error), codegen reordering and default value substitution
- [2026-02-10] Higher-order collection methods: Vector .filter()/.map()/.fold()/.reduce(), Dict .filter()/.fold(), Set .filter()/.fold() — closure-based functional operations with type inference and C codegen
- [2026-02-10] Iterator[T] trait: built-in trait with `next(&self) -> Option[T]` method, user types implement via `equip Foo with Iterator[int]`, for-loop integration emits while/next/break pattern, trait_generic_args tracked in EquipInfo, mutable self support for &self params
- [2026-02-10] Match exhaustiveness checking: semantic analysis rejects non-exhaustive enum matches with `NonExhaustiveMatch` error listing missing variants; handles constructors, or-patterns, wildcards, catch-all bindings, guards; skips non-enum types
- [2026-02-10] Runtime safety: bounds checking on Vector get/set/remove/pop (gorget_array_get, gorget_array_set, gorget_array_remove), division by zero guard on `/` and `%` operators — panics with clear error messages instead of UB
- [2026-02-10] Trait bounds enforcement: `where T is Trait` clauses now checked at generic call sites in semantic analysis, UnsatisfiedTraitBound error emitted when concrete type lacks required trait impl
- [2026-02-10] Generic function monomorphization: type substitutions now propagate into block bodies (local vars, casts, nested generic calls), added type_subs field to CodegenContext, type_to_c() convenience method
- [2026-02-10] File I/O: built-in File type with GorgetFile C runtime, free functions (read_file, write_file, append_file, file_exists), File struct (File.open, File.create, .read_all, .write, .close), Drop auto-close on scope exit
- [2026-02-10] `gg fmt` code formatter: lexer emits Comment tokens, parser side-tables them, AST-walking formatter with comment interleaving, --in-place flag, idempotency tested on all fixtures
- [2026-02-10] Default trait method resolution: codegen emits default method bodies when equip block doesn't override, vtable wiring, trait method call resolution for trait-provided methods
- [2026-02-10] Trait inheritance (extends) in vtables: child vtable structs include parent method slots, equip blocks validate and emit parent methods, semantic validation checks inherited required methods
- [2026-02-10] Drop trait / RAII (destructors): built-in Drop trait, scope-based cleanup at function/loop exit, Box[T] auto-free, user-defined Drop via equip, cleanup before return/break/continue
- [2026-02-10] Implicit `it` in closures: parser auto-wraps call args containing `it` in ImplicitClosure, typecheck assigns fresh type var to `it`, codegen delegates to existing closure machinery
- [2026-02-10] Box[T]: heap allocation wrapper (Box(v) and Box.new(v) constructors, .get()/.set() methods, *b deref, string interpolation, type inference)
- [2026-02-10] Core traits: Displayable, Equatable, Cloneable, Hashable — built-in trait registration, auto-hooks for ==/!= (Equatable) and string interpolation (Displayable), Self type resolution in equip blocks
- [2026-02-10] Iterator protocol: for-loop iteration over Dict and Set collections (key-only, key-value tuple, for-else support)
- [2026-02-10] Add `moving` and `mutable` keywords as ownership operator alternatives (both forms coexist with `!`/`&`)
- [2026-02-10] Option[T]/Result[T,E]: .map(), .and_then(), .or_else() with closure return type inference and non-capturing closure codegen
- [2026-02-10] Option[T] / Result[T,E] methods: unwrap, unwrap_or, is_some/is_none, is_ok/is_err (built-in type registration, typecheck, codegen, monomorphization)
- [2026-02-10] Collections: Vector[T], HashMap[K,V], HashSet[T] with real impls (set/remove/clear/is_empty methods, generic return types, C runtime support)
